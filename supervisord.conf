[supervisord]
nodaemon=true
logfile=/var/log/chatbot/supervisord.log

[program:ollama]
command=ollama serve
autostart=true
autorestart=true
stderr_logfile=/var/log/chatbot/ollama.err.log
stdout_logfile=/var/log/chatbot/ollama.out.log
environment=OLLAMA_HOST="0.0.0.0"

[program:php-api]
command=php -S 0.0.0.0:8080 /app/api.php
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/chatbot/php.err.log
stdout_logfile=/var/log/chatbot/php.out.log

[program:flask]
command=python /app/app/app.py
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/chatbot/flask.err.log
stdout_logfile=/var/log/chatbot/flask.out.log
environment=FLASK_ENV="production",PHP_API_URL="http://localhost:8080/api.php"

[program:ollama-pull]
command=sh -c 'sleep 10 && ollama pull llama3'
autostart=true
autorestart=false
startsecs=0
stderr_logfile=/var/log/chatbot/ollama-pull.err.log
stdout_logfile=/var/log/chatbot/ollama-pull.out.log